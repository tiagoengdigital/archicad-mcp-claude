# This file is auto-generated by generate_tools.py. DO NOT EDIT.
import logging
from pydantic import ValidationError
from multiconn_archicad.basic_types import Port
from tapir_archicad_mcp.app import mcp
from tapir_archicad_mcp.context import multi_conn_instance
import time
from typing import Any
from tapir_archicad_mcp.pagination import handle_paginated_request, PAGINATION_CACHE, CACHE_LIFETIME_SECONDS

from multiconn_archicad.models.commands import (
    ChangeSelectionOfElementsParameters,
ChangeSelectionOfElementsResult,
CreateColumnsParameters,
CreateColumnsResult,
CreateMeshesParameters,
CreateMeshesResult,
CreateObjectsParameters,
CreateObjectsResult,
CreatePolylinesParameters,
CreatePolylinesResult,
CreateSlabsParameters,
CreateSlabsResult,
FilterElementsParameters,
FilterElementsResult,
Get3DBoundingBoxesParameters,
Get3DBoundingBoxesResult,
GetAllElementsParameters,
GetAllElementsResult,
GetClassificationsOfElementsParameters,
GetClassificationsOfElementsResult,
GetConnectedElementsParameters,
GetConnectedElementsResult,
GetDetailsOfElementsParameters,
GetDetailsOfElementsResult,
GetElementsByTypeParameters,
GetElementsByTypeResult,
GetGDLParametersOfElementsParameters,
GetGDLParametersOfElementsResult,
GetSelectedElementsResult,
GetSubelementsOfHierarchicalElementsParameters,
GetSubelementsOfHierarchicalElementsResult,
HighlightElementsParameters,
MoveElementsParameters,
MoveElementsResult,
SetClassificationsOfElementsParameters,
SetClassificationsOfElementsResult,
SetDetailsOfElementsParameters,
SetDetailsOfElementsResult,
SetGDLParametersOfElementsParameters,
SetGDLParametersOfElementsResult
)


log = logging.getLogger()


@mcp.tool(
    name="elements_change_selection_of_elements",
    title="ChangeSelectionOfElements",
    description="Adds/removes a number of elements to/from the current selection."
)
def change_selection_of_elements(port: int, params: ChangeSelectionOfElementsParameters) -> ChangeSelectionOfElementsResult:
    """
    Adds/removes a number of elements to/from the current selection.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing change_selection_of_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="ChangeSelectionOfElements",
            parameters=params.model_dump(mode='json')
        )
        return ChangeSelectionOfElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for ChangeSelectionOfElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing ChangeSelectionOfElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_create_columns",
    title="CreateColumns",
    description="Creates Column elements based on the given parameters."
)
def create_columns(port: int, params: CreateColumnsParameters) -> CreateColumnsResult:
    """
    Creates Column elements based on the given parameters.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing create_columns tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="CreateColumns",
            parameters=params.model_dump(mode='json')
        )
        return CreateColumnsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for CreateColumns result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing CreateColumns on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_create_meshes",
    title="CreateMeshes",
    description="Creates Mesh elements based on the given parameters."
)
def create_meshes(port: int, params: CreateMeshesParameters) -> CreateMeshesResult:
    """
    Creates Mesh elements based on the given parameters.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing create_meshes tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="CreateMeshes",
            parameters=params.model_dump(mode='json')
        )
        return CreateMeshesResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for CreateMeshes result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing CreateMeshes on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_create_objects",
    title="CreateObjects",
    description="Creates Object elements based on the given parameters."
)
def create_objects(port: int, params: CreateObjectsParameters) -> CreateObjectsResult:
    """
    Creates Object elements based on the given parameters.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing create_objects tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="CreateObjects",
            parameters=params.model_dump(mode='json')
        )
        return CreateObjectsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for CreateObjects result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing CreateObjects on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_create_polylines",
    title="CreatePolylines",
    description="Creates Polyline elements based on the given parameters."
)
def create_polylines(port: int, params: CreatePolylinesParameters) -> CreatePolylinesResult:
    """
    Creates Polyline elements based on the given parameters.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing create_polylines tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="CreatePolylines",
            parameters=params.model_dump(mode='json')
        )
        return CreatePolylinesResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for CreatePolylines result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing CreatePolylines on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_create_slabs",
    title="CreateSlabs",
    description="Creates Slab elements based on the given parameters."
)
def create_slabs(port: int, params: CreateSlabsParameters) -> CreateSlabsResult:
    """
    Creates Slab elements based on the given parameters.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing create_slabs tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="CreateSlabs",
            parameters=params.model_dump(mode='json')
        )
        return CreateSlabsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for CreateSlabs result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing CreateSlabs on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_filter_elements",
    title="FilterElements",
    description="Tests an elements by the given criterias."
)
def filter_elements(port: int, params: FilterElementsParameters) -> FilterElementsResult:
    """
    Tests an elements by the given criterias.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing filter_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="FilterElements",
            parameters=params.model_dump(mode='json')
        )
        return FilterElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for FilterElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing FilterElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_get3_d_bounding_boxes",
    title="Get3DBoundingBoxes",
    description="Get the 3D bounding box of elements. The bounding box is calculated from the global origin in the 3D view. The output is the array of the bounding boxes respective to the input array of elements."
)
def get3_d_bounding_boxes(port: int, params: Get3DBoundingBoxesParameters) -> Get3DBoundingBoxesResult:
    """
    Get the 3D bounding box of elements. The bounding box is calculated from the global origin in the 3D view. The output is the array of the bounding boxes respective to the input array of elements.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing get3_d_bounding_boxes tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="Get3DBoundingBoxes",
            parameters=params.model_dump(mode='json')
        )
        return Get3DBoundingBoxesResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for Get3DBoundingBoxes result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing Get3DBoundingBoxes on port {port}: {e}")
        raise e



class PaginatedGetAllElementsResult(GetAllElementsResult):
    """A paginated version of the GetAllElementsResult."""
    elements: list[Any]
    next_page_token: str | None = None



@mcp.tool(
    name="elements_get_all_elements",
    title="GetAllElements",
    description="Returns the identifier of all elements on the plan. Use the optional filter parameter for filtering."
)
def get_all_elements(port: int, params: GetAllElementsParameters, page_token: str | None = None) -> PaginatedGetAllElementsResult:
    """
    Returns the identifier of all elements on the plan. Use the optional filter parameter for filtering.
    This response is paginated. If 'next_page_token' is returned, call this function
    again with that token to get the next page of results.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing get_all_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        cache_key = f"{port}:GetAllElements:{params.model_dump_json()}"

        if not page_token:
            full_response_dict = conn_header.core.post_tapir_command(
                command="GetAllElements",
                parameters=params.model_dump(mode='json')
            )
            full_response_model = GetAllElementsResult.model_validate(full_response_dict)
            PAGINATION_CACHE[cache_key] = (full_response_model, time.time())

        if cache_key not in PAGINATION_CACHE:
            raise ValueError("Pagination session expired or invalid. Please start a new request.")

        full_response_model, timestamp = PAGINATION_CACHE[cache_key]
        if time.time() - timestamp > CACHE_LIFETIME_SECONDS:
            del PAGINATION_CACHE[cache_key]
            raise ValueError("Pagination session expired. Please start a new request.")

        list_to_paginate = getattr(full_response_model, "elements")
        paginated_result = handle_paginated_request(list_to_paginate, page_token)

        response_data = full_response_model.model_dump()
        response_data["elements"] = paginated_result.items
        response_data["next_page_token"] = paginated_result.next_page_token

        return PaginatedGetAllElementsResult.model_validate(response_data)

    except ValidationError as e:
        log.error(f"Validation error for GetAllElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetAllElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_get_classifications_of_elements",
    title="GetClassificationsOfElements",
    description="Returns the classification of the given elements in the given classification systems. It works for subelements of hierarchal elements also."
)
def get_classifications_of_elements(port: int, params: GetClassificationsOfElementsParameters) -> GetClassificationsOfElementsResult:
    """
    Returns the classification of the given elements in the given classification systems. It works for subelements of hierarchal elements also.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing get_classifications_of_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="GetClassificationsOfElements",
            parameters=params.model_dump(mode='json')
        )
        return GetClassificationsOfElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for GetClassificationsOfElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetClassificationsOfElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_get_connected_elements",
    title="GetConnectedElements",
    description="Gets connected elements of the given elements."
)
def get_connected_elements(port: int, params: GetConnectedElementsParameters) -> GetConnectedElementsResult:
    """
    Gets connected elements of the given elements.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing get_connected_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="GetConnectedElements",
            parameters=params.model_dump(mode='json')
        )
        return GetConnectedElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for GetConnectedElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetConnectedElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_get_details_of_elements",
    title="GetDetailsOfElements",
    description="Gets the details of the given elements (geometry parameters etc)."
)
def get_details_of_elements(port: int, params: GetDetailsOfElementsParameters) -> GetDetailsOfElementsResult:
    """
    Gets the details of the given elements (geometry parameters etc).

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing get_details_of_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="GetDetailsOfElements",
            parameters=params.model_dump(mode='json')
        )
        return GetDetailsOfElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for GetDetailsOfElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetDetailsOfElements on port {port}: {e}")
        raise e



class PaginatedGetElementsByTypeResult(GetElementsByTypeResult):
    """A paginated version of the GetElementsByTypeResult."""
    elements: list[Any]
    next_page_token: str | None = None



@mcp.tool(
    name="elements_get_elements_by_type",
    title="GetElementsByType",
    description="Returns the identifier of every element of the given type on the plan. It works for any type. Use the optional filter parameter for filtering."
)
def get_elements_by_type(port: int, params: GetElementsByTypeParameters, page_token: str | None = None) -> PaginatedGetElementsByTypeResult:
    """
    Returns the identifier of every element of the given type on the plan. It works for any type. Use the optional filter parameter for filtering.
    This response is paginated. If 'next_page_token' is returned, call this function
    again with that token to get the next page of results.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing get_elements_by_type tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        cache_key = f"{port}:GetElementsByType:{params.model_dump_json()}"

        if not page_token:
            full_response_dict = conn_header.core.post_tapir_command(
                command="GetElementsByType",
                parameters=params.model_dump(mode='json')
            )
            full_response_model = GetElementsByTypeResult.model_validate(full_response_dict)
            PAGINATION_CACHE[cache_key] = (full_response_model, time.time())

        if cache_key not in PAGINATION_CACHE:
            raise ValueError("Pagination session expired or invalid. Please start a new request.")

        full_response_model, timestamp = PAGINATION_CACHE[cache_key]
        if time.time() - timestamp > CACHE_LIFETIME_SECONDS:
            del PAGINATION_CACHE[cache_key]
            raise ValueError("Pagination session expired. Please start a new request.")

        list_to_paginate = getattr(full_response_model, "elements")
        paginated_result = handle_paginated_request(list_to_paginate, page_token)

        response_data = full_response_model.model_dump()
        response_data["elements"] = paginated_result.items
        response_data["next_page_token"] = paginated_result.next_page_token

        return PaginatedGetElementsByTypeResult.model_validate(response_data)

    except ValidationError as e:
        log.error(f"Validation error for GetElementsByType result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetElementsByType on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_get_gdl_parameters_of_elements",
    title="GetGDLParametersOfElements",
    description="Gets all the GDL parameters (name, type, value) of the given elements."
)
def get_gdl_parameters_of_elements(port: int, params: GetGDLParametersOfElementsParameters) -> GetGDLParametersOfElementsResult:
    """
    Gets all the GDL parameters (name, type, value) of the given elements.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing get_gdl_parameters_of_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="GetGDLParametersOfElements",
            parameters=params.model_dump(mode='json')
        )
        return GetGDLParametersOfElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for GetGDLParametersOfElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetGDLParametersOfElements on port {port}: {e}")
        raise e



class PaginatedGetSelectedElementsResult(GetSelectedElementsResult):
    """A paginated version of the GetSelectedElementsResult."""
    elements: list[Any]
    next_page_token: str | None = None



@mcp.tool(
    name="elements_get_selected_elements",
    title="GetSelectedElements",
    description="Gets the list of the currently selected elements."
)
def get_selected_elements(port: int, page_token: str | None = None) -> PaginatedGetSelectedElementsResult:
    """
    Gets the list of the currently selected elements.
    This response is paginated. If 'next_page_token' is returned, call this function
    again with that token to get the next page of results.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing get_selected_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        cache_key = f"{port}:GetSelectedElements"

        if not page_token:
            full_response_dict = conn_header.core.post_tapir_command(
                command="GetSelectedElements",
                parameters={}
            )
            full_response_model = GetSelectedElementsResult.model_validate(full_response_dict)
            PAGINATION_CACHE[cache_key] = (full_response_model, time.time())

        if cache_key not in PAGINATION_CACHE:
            raise ValueError("Pagination session expired or invalid. Please start a new request.")

        full_response_model, timestamp = PAGINATION_CACHE[cache_key]
        if time.time() - timestamp > CACHE_LIFETIME_SECONDS:
            del PAGINATION_CACHE[cache_key]
            raise ValueError("Pagination session expired. Please start a new request.")

        list_to_paginate = getattr(full_response_model, "elements")
        paginated_result = handle_paginated_request(list_to_paginate, page_token)

        response_data = full_response_model.model_dump()
        response_data["elements"] = paginated_result.items
        response_data["next_page_token"] = paginated_result.next_page_token

        return PaginatedGetSelectedElementsResult.model_validate(response_data)

    except ValidationError as e:
        log.error(f"Validation error for GetSelectedElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetSelectedElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_get_subelements_of_hierarchical_elements",
    title="GetSubelementsOfHierarchicalElements",
    description="Gets the subelements of the given hierarchical elements."
)
def get_subelements_of_hierarchical_elements(port: int, params: GetSubelementsOfHierarchicalElementsParameters) -> GetSubelementsOfHierarchicalElementsResult:
    """
    Gets the subelements of the given hierarchical elements.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing get_subelements_of_hierarchical_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="GetSubelementsOfHierarchicalElements",
            parameters=params.model_dump(mode='json')
        )
        return GetSubelementsOfHierarchicalElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for GetSubelementsOfHierarchicalElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing GetSubelementsOfHierarchicalElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_highlight_elements",
    title="HighlightElements",
    description="Highlights the elements given in the elements array. In case of empty elements array removes all previously set highlights."
)
def highlight_elements(port: int, params: HighlightElementsParameters) -> None:
    """
    Highlights the elements given in the elements array. In case of empty elements array removes all previously set highlights.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing highlight_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        conn_header.core.post_tapir_command(
            command="HighlightElements",
            parameters=params.model_dump(mode='json')
        )
        return None

    except ValidationError as e:
        log.error(f"Validation error for HighlightElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing HighlightElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_move_elements",
    title="MoveElements",
    description="Moves elements with a given vector."
)
def move_elements(port: int, params: MoveElementsParameters) -> MoveElementsResult:
    """
    Moves elements with a given vector.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing move_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="MoveElements",
            parameters=params.model_dump(mode='json')
        )
        return MoveElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for MoveElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing MoveElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_set_classifications_of_elements",
    title="SetClassificationsOfElements",
    description="Sets the classifications of elements. In order to set the classification of an element to unclassified, omit the classificationItemId field. It works for subelements of hierarchal elements also."
)
def set_classifications_of_elements(port: int, params: SetClassificationsOfElementsParameters) -> SetClassificationsOfElementsResult:
    """
    Sets the classifications of elements. In order to set the classification of an element to unclassified, omit the classificationItemId field. It works for subelements of hierarchal elements also.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing set_classifications_of_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="SetClassificationsOfElements",
            parameters=params.model_dump(mode='json')
        )
        return SetClassificationsOfElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for SetClassificationsOfElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing SetClassificationsOfElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_set_details_of_elements",
    title="SetDetailsOfElements",
    description="Sets the details of the given elements (floor, layer, order etc)."
)
def set_details_of_elements(port: int, params: SetDetailsOfElementsParameters) -> SetDetailsOfElementsResult:
    """
    Sets the details of the given elements (floor, layer, order etc).

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing set_details_of_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="SetDetailsOfElements",
            parameters=params.model_dump(mode='json')
        )
        return SetDetailsOfElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for SetDetailsOfElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing SetDetailsOfElements on port {port}: {e}")
        raise e



@mcp.tool(
    name="elements_set_gdl_parameters_of_elements",
    title="SetGDLParametersOfElements",
    description="Sets the given GDL parameters of the given elements."
)
def set_gdl_parameters_of_elements(port: int, params: SetGDLParametersOfElementsParameters) -> SetGDLParametersOfElementsResult:
    """
    Sets the given GDL parameters of the given elements.

    To find a valid 'port' number, use the 'tapir_discovery_list_active_archicads' tool.
    """
    log.info(f"Executing set_gdl_parameters_of_elements tool on port {port}")
    multi_conn = multi_conn_instance.get()
    target_port = Port(port)
    if target_port not in multi_conn.active:
        raise ValueError(f"Port {port} is not an active Archicad connection.")
    conn_header = multi_conn.active[target_port]
    try:

        result_dict = conn_header.core.post_tapir_command(
            command="SetGDLParametersOfElements",
            parameters=params.model_dump(mode='json')
        )
        return SetGDLParametersOfElementsResult.model_validate(result_dict)

    except ValidationError as e:
        log.error(f"Validation error for SetGDLParametersOfElements result: {e}")
        raise ValueError(f"Received an invalid response from the Archicad API: {e}")
    except Exception as e:
        log.error(f"Error executing SetGDLParametersOfElements on port {port}: {e}")
        raise e
